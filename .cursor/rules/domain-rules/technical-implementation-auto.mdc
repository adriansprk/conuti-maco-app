---
description: Technical implementation guide for specific MaKo messages and BDEW process IDs
globs:
  - "**/*.yaml"
  - "**/*.yml"
  - "**/*.json"
  - "**/AI_AGENT_SETUP.md"
  - "**/PROCESS_GRAPH.json"
  - "docs/entry-points/**/*"
  - "backend/**/*"
  - "src/**/*"
  - "api/**/*"
alwaysApply: false
tags: [technical, implementation, api, schemas, bdew-id]
priority: 2
version: 1.2.1
---

# Technical Implementation - Entry Point 2

## When to Use This Rule

Apply when user asks about:
- API structure, schemas, or technical details
- Building payloads for known process IDs
- Understanding data structures
- Specific BDEW process IDs or implementation

## Workflow: Specific Message → Implementation

### Step 1: Start with AI_AGENT_SETUP.md

**ALWAYS START HERE** for technical implementation tasks.

**CRITICAL**: Read actual schema files - never guess API structures or field names.

**File Location**: `docs/entry-points/AI_AGENT_SETUP.md`

<example>
**User**: "I need to implement process 55077"

**Agent Action**:
1. **READ** `docs/entry-points/AI_AGENT_SETUP.md` for technical setup
2. **READ** `docs/entry-points/PROCESS_GRAPH.json`: `indexes.by_bdew_id["55077"]` (verify actual data)
   - ⚠️ If that key is missing, inspect `indexes.*` in the actual `PROCESS_GRAPH.json` and use the key that exists.
3. **READ** PI_55077.yml (verify actual schema structure)
4. **READ** yaml_output/55077.yaml (verify actual business rules)
5. **READ** bo4e-openapi.min.json (verify actual BO4E types)
6. **READ** example: maco-edi-testfiles/outbound/v202510/utilmd/55077/1.json (⚠️ ALWAYS use v202510, NOT v202404. v202510: Outbound=JSON format)
7. **Cite all sources** in response
8. If the question is workflow/process-level: include visualizations (sequence + dependencies). For narrow lookups: answer directly with citations.
</example>

### Step 2: Lookup Process in PROCESS_GRAPH.json
⚠️ **Option A note**: This repo uses `PROCESS_GRAPH.json` as a minimal index. Derive dependencies/prerequisites by reading the referenced `docs-offline/*.md` sources (Mermaid + prose; follow `ref`).

Use `docs/entry-points/PROCESS_GRAPH.json` indexes for fast lookup:
- By BDEW ID: `indexes.by_bdew_id["55077"]`
- By trigger: `indexes.by_trigger["START_LIEFERBEGINN"]`
- By process name: `indexes.by_process_name["lieferbeginn"]`

⚠️ Index key names can differ across versions. If a key shown in examples doesn't exist, inspect `indexes.*` in the actual file.

### Step 3: Create Process Visualization (when needed)

If the user asks about process flow / dependencies / end-to-end behavior, include:
- Sequence diagram (Mermaid)
- Dependency flowchart (Mermaid)
- Required vs optional fields table
- Example message references (v202510)

For narrow factual questions (single field / endpoint / file path), skip diagrams unless requested.

### Step 4: Understand Technical Requirements (doc order)

Reference in this order:
1. `docs/llm.txt` (find relevant docs)
2. `docs-offline/` (process docs + Prozessübersicht)
3. `docs-offline/enhanced-index.json` (optional)

### Step 5: Check Business Rules, Validation Logic & Schemas

**Business Rules** (mandatory fields):
- `maco-api-documentation/pythons/createPiFromTemplater/templater/yaml_output/[ID].yaml`

**Business Validation Logic** (rejection codes, validation steps):
- Find EBD code in process docs (`docs-offline/{process}.md` contains `Entscheidungsbaum E_{code}`)
- ⚠️ ALWAYS use newest EBD folder: `ebd-diagrams/FV{YYMM}/`
- EBD JSON: `ebd-diagrams/FV{YYMM}/E_{code}.json`
- Optional: `.dot` / `.svg`

**Technical Implementation Details** (system architecture, transformations, APERAK workflow):
- Canonical: `docs-offline/prozessdiagramme-png/INDEX.md` → view `{process-name}.png`
- Fallback (legacy): `docs-offline/Prozessdiagramme PNG/`

**API Schemas**:
- Process schemas: `maco-api-documentation/macoapp-schreiben/components/requestBodies/PIs/PI_[ID].yml`
- BO4E types: `maco-api-documentation/_build/bo4e-openapi.min.json`

**API Operations**:
- Write: `maco-api-documentation/_build/macoapp-schreiben.min.json`
- Read: `maco-api-documentation/_build/macoapp-lesen.min.json`
- Trigger: `maco-api-documentation/_build/macoapp-trigger.min.json`
- MaloIdent request: `maco-api-documentation/_build/maloident-macoapp.min.json`
- MaloIdent response: `maco-api-documentation/_build/maloident-lieferant.min.json`

### Step 6: Check Example Messages (⚠️ v202510 only)

- **Inbound**: `maco-edi-testfiles/inbound/v202510/{message_type}/{process-id}/*.edi` (received, EDIFACT)
- **Outbound**: `maco-edi-testfiles/outbound/v202510/{message_type}/{process-id}/*.json` (sent, BO4E JSON)

## Cross-Reference Pattern

Always follow this pattern:
```
Business rules (yaml_output/)
  → Process schemas (PIs/)
  → BO4E types (_build/bo4e-openapi.min.json)
  → Business validation (find EBD code → latest FV dir → E_{code}.json)
  → Technical implementation (PNG INDEX.md → view PNG if exists)
  → Examples (v202510 only: inbound EDI / outbound JSON)
  → Visualization (only when it helps)
  → Implementation
```

## API Direction Reminder

- **Outbound**: Your backend → Conuti API (trigger, send data)
- **Inbound**: Conuti API → Your backend webhooks (receive responses, receive data)

