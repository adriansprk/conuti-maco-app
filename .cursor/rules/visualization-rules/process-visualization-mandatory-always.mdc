---
description: MANDATORY - Always create visualizations when discussing processes - sequences, message types, fields, examples
alwaysApply: true
tags: [visualization, mermaid, processes, mandatory]
priority: 1
version: 1.2.1
---

# Process Visualization - MANDATORY Rule

## Critical Requirement

**ALWAYS create visualizations** when discussing, explaining, or implementing **MaKo processes / workflows**. Visualizations are REQUIRED for process-level answers.

## When to Create Visualizations

Create visualizations when user asks about:
- Process sequences or workflows
- Process dependencies or prerequisites
- Message flows (inbound/outbound)
- Required vs optional fields
- Process implementation steps
- Business scenarios involving processes
- Any process-related question

### Fast Path (Skip Diagrams for Narrow Lookups)

If the user asks a **narrow factual question** (single field, single endpoint, single file location, single code lookup) and no workflow explanation is needed, answer directly with:
- The minimal cited fact(s)
- File references and/or schema references

Add visualizations only if they materially reduce confusion or the user requests them.

## Visualization Requirements

### 1. Process Sequence Diagram (Mermaid)

**ALWAYS include** a sequence diagram showing:
- Process steps in order
- Actors (Backend, Conuti, NB, MSB)
- Message types and directions
- Prerequisites and outcomes

<example>
```mermaid
sequenceDiagram
    participant Backend
    participant Conuti
    participant NB as Network Operator
    
    Backend->>Conuti: START_LIEFERBEGINN (55077)
    Conuti->>NB: EDIFACT Message
    NB-->>Conuti: Response (55002/55003)
    Conuti->>Backend: Webhook (PI_55002 or PI_55003)
```
</example>

### 2. Process Flow Diagram (Mermaid)

**ALWAYS include** a flowchart showing:
- Process dependencies
- Prerequisites
- What processes trigger next
- Decision points (success/rejection paths)

<example>
```mermaid
flowchart TD
    A[MALOIDENT] -->|Success| B[LIEFERBEGINN 55077]
    A -->|Rejection| E[E_0594 Error]
    B -->|Success| C[STAMMDATENAENDERUNG]
    B -->|Rejection| D[55003 Negative Response]
```
</example>

### 3. Message Structure Table

**ALWAYS include** a table showing:
- Message types (trigger, inbound, outbound)
- Required fields (from yaml_output/)
- Optional fields
- Example message references

<example>
| Message Type | Direction | Required Fields | Optional Fields | Example |
|------------|-----------|----------------|----------------|---------|
| START_LIEFERBEGINN | Outbound | marktlokationsId, lieferbeginn | zusatzdaten | maco-edi-testfiles/outbound/v202510/utilmd/55077/1.json (‚ö†Ô∏è v202510, JSON format) |
| PI_55002 | Inbound | marktlokationsId, zustimmung | hinweise | maco-edi-testfiles/inbound/v202510/utilmd/55002/1.edi (‚ö†Ô∏è v202510, EDI format) |
</example>

### 4. Field Requirements Visualization

**ALWAYS show** required vs optional fields:
- Use PROCESS_GRAPH.json for process structure
- Reference yaml_output/[ID].yaml for mandatory fields
- Show BO4E type definitions from bo4e-openapi.min.json

<example>
**Process 55077 (Lieferbeginn) Fields**:
- ‚úÖ **Required**: `marktlokationsId` (string), `lieferbeginn` (date)
- ‚ö†Ô∏è **Optional**: `zusatzdaten` (object), `hinweise` (string)
- üìã **Schema**: PI_55077.yml
- üìù **Business Rules**: yaml_output/55077.yaml
</example>

## Visualization Format

**Preferred**: Mermaid diagrams (sequence, flowchart, class diagrams)
**Alternative**: Structured markdown tables and lists
**Always Include**: 
- Process ID (BDEW Pr√ºfidentifikator)
- Process name
- Message types and directions
- Required/optional fields
- Example message references

## Data Sources for Visualizations (Option A: Minimal Index)

1. **Process Structure**
   - **Discovery**: `docs/entry-points/PROCESS_GRAPH.json` (`indexes.*`) ‚Üí find the relevant `docs-offline/...` files fast
   - **Source of truth (today)**: Mermaid diagrams + prose inside those `docs-offline/*.md` files (including any `ref` references)
   - **Optional (future)**: if `PROCESS_GRAPH.json` is regenerated with populated `processes.*`, you may also use:
     - `processes.[PROCESS_ID].prerequisites`
     - `processes.[PROCESS_ID].triggers_processes`
     - `processes.[PROCESS_ID].api.outbound` / `.inbound`

2. **Field Requirements**: `maco-api-documentation/pythons/createPiFromTemplater/templater/yaml_output/[ID].yaml`

3. **Message Schemas**: `maco-api-documentation/macoapp-schreiben/components/requestBodies/PIs/PI_[ID].yml`

4. **BO4E Types**: `maco-api-documentation/_build/bo4e-openapi.min.json`

5. **Examples**: `maco-edi-testfiles/inbound/v202510/` (EDI format) and `/outbound/v202510/` (JSON format) (‚ö†Ô∏è ALWAYS use v202510, NOT v202404. v202510: Outbound=JSON, Inbound=EDI)

6. **System Architecture & Technical Flow**: `docs-offline/prozessdiagramme-png/` (canonical)
   - Fallback (legacy path): `docs-offline/Prozessdiagramme PNG/`
   - **INDEX.md** - Text-based index of all 54 PNG files (use for discovery - search by process name or role)
   - Reference PNG files for: system architecture (swimlanes: Backend LF, MPS, MCS, Kommunikation), format transformations (BO4E‚ÜîEDI), APERAK workflow (Zustimmung? decision points), message sequence, conditional data updates
   - ‚ö†Ô∏è **Note**: PNG files require visual analysis - use INDEX.md first to find relevant files
   - **Example**: `Lieferbeginn Lieferseite.png` (LF role), `Lieferbeginn Netzbetreiber.png` (NB role)

7. **Business Validation Logic**: `ebd-diagrams/FV{YYMM}/E_{code}.json` or `.dot`
   - ‚ö†Ô∏è **ALWAYS use latest EBD version** - check `ebd-diagrams/` for newest `FV{YYMM}/` directory
   - Reference EBD JSON/DOT for: validation steps, rejection codes, decision tree logic
   - **How to find EBD code**: Check process markdown docs for "Entscheidungsbaum E_{code}" references
   - **Example**: LIEFERBEGINN uses E_0622 (pre-validation), E_0623 (main validation)

## Response Format

When discussing processes, **ALWAYS structure response as**:

```markdown
## Process Overview
[Brief description]

## Process Sequence
```mermaid
[Sequence diagram]
```

## Process Flow
```mermaid
[Flowchart diagram]
```

## Message Types & Fields
[Table with required/optional fields]

## Example Messages
[References to test files]
```

<invalid-example>
**Don't**: Explain a process without visualizations
**Don't**: Skip sequence diagrams for multi-step processes
**Don't**: Forget to show required vs optional fields
**Don't**: Omit example message references
</invalid-example>

<valid-example>
**Do**: Always start with a sequence diagram
**Do**: Show process dependencies in a flowchart
**Do**: Include a table of message types and fields
**Do**: Reference example messages from maco-edi-testfiles/inbound/v202510/ (EDI format) or maco-edi-testfiles/outbound/v202510/ (JSON format) (‚ö†Ô∏è ALWAYS use v202510. v202510: Outbound=JSON, Inbound=EDI)
**Do**: Use PROCESS_GRAPH.json data for accurate visualizations
**Do**: First check PNG INDEX.md, then reference/view PNG files for technical implementation details (system architecture, format transformations, APERAK workflow)
**Do**: Find EBD code in process docs, then reference EBD JSON/DOT files from latest FV directory for business validation logic (validation steps, rejection codes)
**Do**: State explicitly when no PNG or EBD file exists for a process
</valid-example>

## When to Reference Existing Visualizations

**PNG Files** (`docs-offline/prozessdiagramme-png/`):
- ‚úÖ **First check INDEX.md** for discovery - search by process name or role to find relevant PNG files
- ‚úÖ **Reference PNG file path** when discussing:
  - System architecture (swimlanes: Backend LF, MPS, MCS, Kommunikation)
  - Format transformations (BO4E‚ÜîEDI)
  - APERAK technical workflow (Zustimmung? decision points)
  - Complete message sequence (end-to-end flow)
  - Conditional data updates (only on positive APERAK)
- ‚úÖ **Create new Mermaid visualizations** based on PNG content when:
  - User needs simplified/abstracted view
  - User needs specific subset of PNG information
  - User needs interactive/editable diagram
- ‚úÖ **Describe PNG content** when user needs to understand system architecture
- ‚ö†Ô∏è **Note**: PNG files require visual analysis - text extraction may be imprecise for complex diagrams
- ‚ùå **Don't claim to show PNG content** without having actually viewed/analyzed it
- ‚ùå **If no PNG exists**: State explicitly "No PNG file found for this process" - only 54 processes have PNG diagrams

**EBD JSON/DOT Files** (`ebd-diagrams/FV{YYMM}/`):
- ‚ö†Ô∏è **ALWAYS use latest EBD version** - check for newest `FV{YYMM}/` directory (e.g., FV2604)
- ‚úÖ **Find EBD code first**: Check process markdown docs for "Entscheidungsbaum E_{code}" references
- ‚úÖ **Reference EBD JSON/DOT files** when discussing:
  - Business validation logic
  - Rejection codes (complete list)
  - Validation step-by-step guides
  - Decision tree structure
- ‚úÖ **Create new Mermaid visualizations** based on EBD content when:
  - User needs simplified validation flow
  - User needs specific validation path
  - User needs interactive decision tree
- ‚ùå **If no EBD exists**: State explicitly "No EBD file found for this process" - not all processes have EBD validation trees
