---
description: CRITICAL - Never hallucinate - always read documentation files before answering. Verify all information against source files.
alwaysApply: true
tags: [critical, anti-hallucination, documentation, verification, mandatory]
priority: 1
version: 2.1.0
---

# Anti-Hallucination Rule - CRITICAL

## ⚠️ CRITICAL REQUIREMENT

**NEVER provide information without first reading the relevant documentation files.**

**NEVER make up, guess, or assume process details, field names, API endpoints, or data structures.**

**ALWAYS verify information against source files before providing answers.**

## Mandatory Verification Process

### Step 1: Discovery (via Minimal Index)

**Use `docs/entry-points/PROCESS_GRAPH.json` ONLY for discovery:**

- `indexes.by_bdew_id["55016"]` → find relevant files mentioning this Prüfi
- `indexes.by_trigger["START_KUENDIGUNG"]` → find files with this trigger
- `indexes.by_process_name["kuendigung"]` → find process files

**⚠️ CRITICAL: The index does NOT contain process details. It only points to source files. You MUST read the source files.**

### Step 2: Extract from Source Documentation

**Read the actual files discovered in Step 1:**

- `docs-offline/{filename}.md` → Full process documentation, Mermaid diagrams
- Parse sequence diagrams for: message order, participant roles, conditional flows (opt/alt), cross-references (ref)
- Extract roles, prerequisites, relationships directly from source docs
- Read German prose explanations for context and nuance

### Step 2b: Parse Mermaid Diagrams - CRITICAL Reference Handling

**⚠️ CRITICAL: When parsing Mermaid sequence diagrams, pay special attention to references and context:**

#### "ref" Markers - MANDATORY Reading

**When you see "ref" in a Mermaid diagram:**
- ⚠️ **This means "reference to a separate process documented elsewhere"**
- ✅ **You MUST read the referenced documentation before describing the process**
- ❌ **The "ref" notation does NOT mean the process only runs internally**
- ✅ **Example**: `NB ->> NB : ref Stammdatenänderung` → Read `docs-offline/stammdatenänderung-vom-netzbetreiber-verantwortlich-rolle-lf-*.md`
- ✅ **Use PROCESS_GRAPH.json** to find referenced process documentation via `indexes.by_bdew_id["55615"]` or search by process name
- ⚠️ **If a referenced file is mentioned in a ref block but is not available in the context**: Explicitly state: "The process refers to [Process Name], but I do not have access to that file to confirm details."

#### Context Phrases - Role Interpretation

**⚠️ CRITICAL: When a process block says "gegenüber [Role] durchführen":**
- ✅ **"gegenüber LFN durchführen"** → LF (Lieferant) is involved, receives messages
- ✅ **"gegenüber NB durchführen"** → NB is involved
- ✅ **"immer, gegenüber LFN"** → Always involves LF
- ⚠️ **Even if the diagram shows "NB ->> NB", if it says "gegenüber LF", the LF receives messages**
- ✅ **You MUST verify the actual message direction in the referenced documentation**

#### ⚠️ RED FLAG: "ref" + "gegenüber" Combination

**When you see BOTH:**
- "ref" (reference to separate process)
- "gegenüber [Role]" (towards/for a specific role)

**This is a CRITICAL signal:**
- ✅ The process DOES involve that role
- ⚠️ The diagram arrow (e.g., "NB ->> NB") may be misleading
- ✅ You MUST read the referenced documentation
- ✅ The actual message flow will be different from the arrow direction

**Example**:
```mermaid
NB ->> NB : ref Stammdatenänderung vom NB (verantwortlich) ausgehend (*9)
```
With context: "immer, gegenüber LFN durchführen"
→ **LF receives these messages!** Read `stammdatenänderung-vom-netzbetreiber-verantwortlich-rolle-lf-*.md`

#### Mermaid Diagram Interpretation Checklist

When reading Mermaid sequence diagrams, ALWAYS:

- [ ] **Check for "ref" markers**: If present, read referenced documentation
- [ ] **Interpret context phrases**: 
  - "gegenüber LFN durchführen" → LF is involved
  - "gegenüber NB durchführen" → NB is involved
  - "immer, gegenüber LFN" → Always involves LF
- [ ] **Verify message directions**: Don't assume from diagram arrows alone
  - "NB ->> NB" with "ref" → Check referenced docs for actual recipients
  - "NB ->> NB" with "gegenüber LF" → LF receives messages
- [ ] **Check Prüfidentifikatoren**: Look up each Prüfi to verify direction
  - Use `indexes.by_bdew_id["55615"]` to find documentation
  - Read schema files (`PI_{ID}.yml`) to verify inbound vs outbound
- [ ] **Read referenced processes**: For every "ref", find and read the full documentation
- [ ] **Handle missing references**: If a referenced file is not available, explicitly state that the referenced process cannot be confirmed

### Step 3: VERIFY Against Authoritative Sources

**Cross-reference information across authoritative sources:**

| What to Verify | Authoritative Source | How to Check |
|----------------|---------------------|--------------|
| Business goal → Process mapping | `docs/entry-points/BUSINESS_PROCESS_MAP.md` | Confirm process name matches business scenario |
| BDEW ID → Process name | Source docs + `BUSINESS_PROCESS_MAP.md` | Verify process identification |
| Required fields | `maco-api-documentation/pythons/createPiFromTemplater/templater/yaml_output/{bdew_id}.yaml` | Check mandatory field list |
| Message structure | `maco-api-documentation/macoapp-schreiben/components/requestBodies/PIs/PI_{bdew_id}.yml` | Validate request structure |
| Data types | `maco-api-documentation/_build/bo4e-openapi.min.json` | Confirm BO4E schema compliance |
| Example messages | `maco-edi-testfiles/outbound/v202510/{message_type}/{process_id}/*.json` (outbound) or `maco-edi-testfiles/inbound/v202510/{message_type}/{process_id}/*.edi` (inbound) | Validate real-world message format (⚠️ ALWAYS use v202510, NOT v202404. Outbound=JSON, Inbound=EDI) |
| Trigger events | `maco-api-documentation/_build/macoapp-trigger.min.json` | Verify trigger event structure |
| MaloIdent requests | `maco-api-documentation/_build/maloident-macoapp.min.json` | Verify request structure |
| MaloIdent responses | `maco-api-documentation/_build/maloident-lieferant.min.json` | Verify webhook structure |

### Step 3b: Verify Follow-up Processes

**⚠️ CRITICAL: When a process mentions follow-up processes (e.g., "STAMMDATENAENDERUNG", "ABRECHNUNGSDATEN"):**

- [ ] **Find the follow-up process documentation**:
  - Use PROCESS_GRAPH.json to find process files via `indexes.by_bdew_id["55615"]` or search by process name
  - Search for process name in `docs-offline/` directory
- [ ] **Verify message direction**:
  - Check if messages go to LF, NB, MSB, or all
  - Read the sequence diagram in the follow-up process documentation
  - Don't assume from the main process diagram
- [ ] **Check Prüfidentifikatoren**:
  - Each Prüfi has a documented direction (inbound/outbound)
  - Verify against schema files (`PI_{ID}.yml`)
  - Check description in schema: "NB an LF" = inbound for LF, "LF an NB" = outbound for LF
- [ ] **Don't assume from main diagram**:
  - Main process diagrams use "ref" for brevity
  - Always read the referenced process documentation
  - The diagram arrow direction may be misleading

### Step 4: Report Discrepancies

**If source docs and authoritative sources conflict:**

- **State the conflict explicitly**: "I found conflicting information..."
- **Cite both sources**: "Source doc says X, but schema says Y"
- **Tie-breaker rule**: For technical field requirements (required/optional), treat the YAML schema (`yaml_output/{ID}.yaml` or `PI_{ID}.yml`) as the source of truth over markdown prose if they conflict
- **For non-technical conflicts**: Do not assume which is correct - let the user decide or investigate further

### Step 5: Cite Sources

**ALWAYS cite the source file** when providing information. Cite the actual source documentation, not the index.

<valid-example>
**Good Response**:
"I found process 55077 (LIEFERBEGINN) by searching `indexes.by_bdew_id["55077"]` in PROCESS_GRAPH.json, which pointed me to `docs-offline/lieferbeginn.md` and `docs-offline/prozessübersicht-853953m0.md`. 

After reading the source documentation, I found that:
- The Mermaid diagram in `lieferbeginn.md` shows MALOIDENT as a conditional prerequisite (when marktlokationsId is unknown)
- The schema in `maco-api-documentation/macoapp-schreiben/components/requestBodies/PIs/PI_55077.yml` shows that marktlokationsId is a required field
- The business rules in `maco-api-documentation/pythons/createPiFromTemplater/templater/yaml_output/55077.yaml` specify additional constraints
- See example message in `maco-edi-testfiles/outbound/v202510/55077_ausgehend_Testfall1.json` for a complete message structure (⚠️ ALWAYS use v202510 version)."
</valid-example>

<invalid-example>
**Bad Response** (HALLUCINATION):
"According to PROCESS_GRAPH.json, process 55077 requires MALOIDENT as a prerequisite and customer ID as a required field."
**Problem**: PROCESS_GRAPH.json (minimal index) doesn't contain this information. Must read source docs.
</invalid-example>

**If sources conflict, state the conflict explicitly and cite all sources.**

### Step 6: Admit Uncertainty

**If documentation is missing or unclear:**
- **State clearly**: "I cannot find this information in the documentation"
- **List what you checked**: "I checked PROCESS_GRAPH.json (index), found files via `indexes.by_bdew_id["55077"]`, read `docs-offline/lieferbeginn.md`, checked `PI_55077.yml`, and `yaml_output/55077.yaml`"
- **Suggest where to look**: "You may need to check [specific file] or contact support"

**NEVER make up information to fill gaps.**

## Prohibited Behaviors

**NEVER:**
- ❌ Answer without reading documentation files first
- ❌ Make up field names, API endpoints, or data structures
- ❌ Guess process dependencies or prerequisites
- ❌ Assume schema structures without reading PI_[ID].yml
- ❌ Invent business rules without reading yaml_output/[ID].yaml
- ❌ Create example messages without referencing maco-edi-testfiles/ (or use wrong version like v202404)
- ❌ Provide information without citing source files
- ❌ Fill gaps with assumed information
- ❌ **Ignore "ref" markers**: Always read referenced documentation
- ❌ **Ignore context phrases**: "gegenüber LF" means LF is involved
- ❌ **Assume message direction from diagram arrows**: Check referenced docs and Prüfidentifikatoren
- ❌ **Skip follow-up process verification**: Read their documentation, don't assume from main diagram
- ❌ **Ignore missing referenced files**: If a "ref" points to unavailable documentation, state this explicitly rather than guessing

## Required Actions

**ALWAYS:**
- ✅ Use PROCESS_GRAPH.json indexes for discovery (find files), then read source files
- ✅ Read source documentation files (`docs-offline/{filename}.md`) for process details
- ✅ Parse Mermaid diagrams directly from source files
- ✅ **When you see "ref" in a diagram**: Read the referenced process documentation
- ✅ **When you see "gegenüber [Role]"**: Verify that role receives messages, even if diagram shows different arrow
- ✅ Extract roles, prerequisites, relationships from source docs (not from index)
- ✅ Read schema files (`PI_{ID}.yml`) before describing API structures
- ✅ Read business rules (`yaml_output/{ID}.yaml`) before listing required fields
- ✅ Read BO4E types (`bo4e-openapi.min.json`) before describing data structures
- ✅ Reference example messages (`maco-edi-testfiles/inbound/v202510/` for EDI inbound or `maco-edi-testfiles/outbound/v202510/` for JSON outbound) when showing examples (⚠️ ALWAYS use v202510, NEVER v202404. v202510: Outbound=JSON, Inbound=EDI)
- ✅ **For follow-up processes**: Read their separate documentation, don't assume from main diagram
- ✅ **Verify Prüfidentifikatoren directions**: Check schema descriptions for "an LF" (inbound) vs "von LF" (outbound)
- ✅ **Handle missing references**: If a "ref" points to unavailable documentation, explicitly state this limitation
- ✅ Cite source files (not the index) in your response
- ✅ Verify information across multiple authoritative sources
- ✅ **For technical conflicts**: Prefer YAML schemas over markdown prose for field requirements
- ✅ Admit when information is not found in documentation

## Verification Checklist

Before providing any answer about MaKo processes, verify:

- [ ] Process ID identified correctly
- [ ] Used PROCESS_GRAPH.json indexes for discovery (`by_bdew_id`, `by_trigger`, `by_process_name`)
- [ ] Read actual source documentation files from `docs-offline/` (not just the index)
- [ ] Parsed Mermaid diagrams from source files for process flow
- [ ] **Checked for "ref" markers**: If present, read referenced process documentation
- [ ] **Interpreted context phrases**: "gegenüber LF" means LF is involved
- [ ] **Verified message directions**: Don't assume from diagram arrows, check referenced docs
- [ ] **Checked Prüfidentifikatoren**: Verified direction (inbound/outbound) for each Prüfi
- [ ] **For follow-up processes**: Read their separate documentation, verified message recipients
- [ ] Extracted roles, prerequisites, relationships from source docs
- [ ] Schema file read (`PI_{ID}.yml`) - verified message direction from description
- [ ] Business rules file read (`yaml_output/{ID}.yaml`)
- [ ] BO4E types checked (`bo4e-openapi.min.json`)
- [ ] Example messages referenced (`maco-edi-testfiles/inbound/v202510/` for EDI inbound or `maco-edi-testfiles/outbound/v202510/` for JSON outbound) - ⚠️ ALWAYS v202510, NOT v202404 (v202510: Outbound=JSON, Inbound=EDI)
- [ ] Cross-referenced with authoritative sources (BUSINESS_PROCESS_MAP.md, schemas, rules)
- [ ] All information cited with source files (not the index)
- [ ] No information provided without source verification

## Response Format

**Structure your response as:**

```markdown
## Answer

[Your answer based on source documentation]

## Discovery Process

- Used PROCESS_GRAPH.json index: `indexes.by_bdew_id["55077"]` → found files
- Discovered source files: `docs-offline/lieferbeginn.md`, `docs-offline/prozessübersicht-853953m0.md`

## Sources Verified

- Source Documentation: `docs-offline/{filename}.md` (read actual file, parsed Mermaid diagram)
- Schema: `maco-api-documentation/macoapp-schreiben/components/requestBodies/PIs/PI_{ID}.yml`
- Business Rules: `maco-api-documentation/pythons/createPiFromTemplater/templater/yaml_output/{ID}.yaml`
- BO4E Types: `maco-api-documentation/_build/bo4e-openapi.min.json`
- Examples: `maco-edi-testfiles/outbound/v202510/{message_type}/{process_id}/*.json` (outbound JSON) or `maco-edi-testfiles/inbound/v202510/{message_type}/{process_id}/*.edi` (inbound EDI) (⚠️ ALWAYS use v202510, NOT v202404. v202510: Outbound=JSON, Inbound=EDI)
- Business Process Map: `docs/entry-points/BUSINESS_PROCESS_MAP.md` (for business scenarios)
```

## Examples

<valid-example>
**User**: "What fields are required for process 55077?"

**Agent Response**:
"I'll check the documentation for process 55077.

[Uses PROCESS_GRAPH.json index: `indexes.by_bdew_id["55077"]` → finds files]
[Reads `docs-offline/lieferbeginn.md` - finds process documentation and Mermaid diagram]
[Reads `docs-offline/prozessübersicht-853953m0.md` - finds Prozessübersicht with API details]
[Reads `maco-api-documentation/macoapp-schreiben/components/requestBodies/PIs/PI_55077.yml` - finds schema structure]
[Reads `maco-api-documentation/pythons/createPiFromTemplater/templater/yaml_output/55077.yaml` - finds mandatory fields]
[Reads `maco-api-documentation/_build/bo4e-openapi.min.json` - verifies data types]
[References `maco-edi-testfiles/outbound/v202510/utilmd/55077/1.json` - validates message format (⚠️ ALWAYS use v202510, outbound=JSON format)]

According to the schema in `PI_55077.yml` and business rules in `yaml_output/55077.yaml`, the required fields for process 55077 (LIEFERBEGINN) are:
- marktlokationsId (string, required)
- lieferbeginn (date, required)

The source documentation in `docs-offline/lieferbeginn.md` shows this is triggered by START_LIEFERBEGINN and may require MALOIDENT as a prerequisite if marktlokationsId is unknown.

See example in `maco-edi-testfiles/outbound/v202510/utilmd/55077/1.json` for a complete message structure (⚠️ ALWAYS use v202510 version, outbound=JSON format)."
</valid-example>

<invalid-example>
**User**: "What fields are required for process 55077?"

**Bad Agent Response** (HALLUCINATION):
"According to PROCESS_GRAPH.json, the required fields are customer ID, start date, and contract number."

**Problem**: 
- PROCESS_GRAPH.json (minimal index) doesn't contain field information
- No source documentation files read
- No schemas or business rules checked
- Information may be incorrect
</invalid-example>

## Integration with Other Rules

This rule works with:
- **visualization-rules/process-visualization-mandatory-always.mdc**: Visualizations must be based on source documentation (Mermaid diagrams from source files), not assumptions
- **domain-rules/business-discovery-auto.mdc**: Business discovery must use PROCESS_GRAPH.json for discovery, then read BUSINESS_PROCESS_MAP.md and source docs
- **domain-rules/technical-implementation-auto.mdc**: Technical implementation must use indexes for discovery, then read schemas and business rules from source files
- **validation-rules/**: Validation must check against actual schemas and rules from authoritative sources

## Enforcement

**This is a CRITICAL rule with highest priority.**

Violations of this rule (providing information without reading documentation) are **unacceptable**.

If you cannot find information in the documentation, **say so explicitly** rather than guessing.
